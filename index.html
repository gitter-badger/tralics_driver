<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="description" content="Tralics driver : Driver for tralics latex snippets to mathml element conversion" />
  <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
  <title>Tralics driver</title>
</head>
<body>
  <!-- HEADER -->
  <div id="header_wrap" class="outer">
    <header class="inner">
      <a id="forkme_banner" href="https://github.com/tiarno/tralics_driver">View on GitHub</a>
      <h1 id="project_title">Tralics driver</h1>
      <h2 id="project_tagline">
        Driver for tralics to convert LaTeX snippets to MathML elements
      </h2>
      <section id="downloads">
        <a class="zip_download_link" href="https://github.com/tiarno/tralics_driver/zipball/master">Download this project as a .zip file</a>
        <a class="tar_download_link" href="https://github.com/tiarno/tralics_driver/tarball/master">Download this project as a tar.gz file</a>
      </section>
    </header>
  </div>
  <!-- MAIN CONTENT -->
  <div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
      <h3>
        Overview
      </h3>
      <p>Driver for Tralics: Convert LaTeX math snippets to MathML elements</p>
      <p>Note: Tralics is a LaTeX to XML Translator from http://www-sop.inria.fr/marelle/tralics/ <br/>
        This is only a driver.
      </p>

      <h4>Requirements</h4>
      <p>
        <ul>
          <li>Python 2.6 or greater</li>
          <li>Pexpect package</li>
          <li>Tralics installation</li>
          <li>lxml package</li>
        </ul>
      <h4>What does it do?</h4>
      <p>
        The problem this project attempts to solve is when you have LaTeX math snippets
        (inline or block math) and you want to convert them to MathML.
      </p>
      <p>For example, you can write code like the following.
        You write the function <tt>get_mathstring()</tt> yourself.
        See the file <tt>runner.py</tt> for details.
      </p>
      <pre><code>
      from tralics_driver import driver

      math_elems = list()
      t = driver.TralicsDriver('/usr/local')
      for fname, mathstring in get_mathstring():
        elemstring = t.convert(fname, mathstring)
        math_elems.append(elemstring)

      if t.errors:
        print 'ERRORS:'
        print t.errors
      t.stop()
    </code></pre>
    <h4>Assumptions</h4>
    <p>
      <ul>
        <li>You have installed Tralics</li>
        <li>If you have custom <tt>newcommand</tt>s, you put them in a file called
          <tt>newcommands.tex</tt> and place the file in the Tralics <tt>conf</tt> directory</li>
        <li>You want to cache your conversions on disk</li>
      </ul>
    </p>
    </section>
    <section id="project_layout" class="inner">
      <h3>Project Layout</h3>
      <p>The code is structured as follows:</p>
      <ul>
        <li><code>__init__.py</code> Contains helper functions
          <code>unescape</code> and <code>escape</code> to handle html/xml markup changes, and a
          string template to return the contents of an error.</li>

        <li><code>driver.py</code> Contains only the driver class, <code>TralicsDriver</code>. The
          class methods are as follows:

          <ul>
            <li><code>__init__(tralics_dir, options)</code>. Sets up locations for the tralics
              binary, the customized 'newcommands' file if it exists, and the cache file if it exists.
            </li>

            <li><code>start</code> Spawns a <code>pexpect</code> process and reads in the
              customized 'newcommands' file if it exists.</li>

            <li><code>stop</code> Closes the process and writes the cache to disk.</li>

            <li><code>convert(fname, mathstring)</code> returns the MathML string of the
              LaTeX <code>mathstring</code>
              that was found in file name <code>fname</code>. If possible,
              get the converted MathML string from the cache; otherwise, pass the string to the Tralics
              process. Prints a dot (.) for strings found in the cache, or a plus ('+') if the
              string was processed by Tralics.</li>

            <li><code>getmath(expr)</code> Passes the LaTeX string <code>expr</code> to the
              Tralics process and returns the MathML string or an element string containing
              the filename, error message, and LaTeX string that caused the error.</li>

            <li><code>clean_formula(expr, result)</code> Modifies the element string to conform
              to the current MathML spec (changes attributes) or returns an element string containing
              the filename, error message, and LaTeX string that caused the error.</li>

            <li><code>handle_error(data)</code> Records the error data in the instances list of
              errors and returns an element string containing
              the filename, error message, and LaTeX string that caused the error.</li>
        </li>
      </ul>
        <li><code>runner.py</code> Contains an example of how to use the driver on a
          tree of HTML files.</li>
    </ul>
  </section>
  <section id="examples" class="inner">
    <h3>Example</h3>
    <p>This example parses each HTML file from a target directory.
      It assumes that some images (those with <tt>class="math"></tt>) contain <tt>alt</tt>
      text containing the LaTeX markup used to create the image.</p>
    <p>For each image, it
      <ul>
        <li> passes the LaTeX markup string to the Tralics driver to get the MathML version</li>
        <li> creates an element from that MathML string</li>
        <li> and replaces the original image element with the MathML element</li>
        <li> writes the new tree (a copy of the original) to a new directory</li>
      </ul>
    </p>
    <p>
      So at the beginning there was one HTML tree of files that uses images for math.
      At the end, the original directory is untouched, and there is an identical HTML
      directory that contains MathML elements instead of the original images.
    </p>

    <code><pre>
      from tralics_driver import driver
      target_dir = '/some/dir/with/html_files'
      mathml_root = '/another/place/to/write/new/html_files'
      d = {
        'type': 'text/javascript',
        'src':'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=MML_HTMLorMML'
        }
      mathjax_elem = etree.Element('script', attrib=d)

      t = driver.TralicsDriver()
      for fname in [x for x in os.listdir(target_dir) if x.endswith('.html')]:
        parser = etree.HTMLParser()
        tree = etree.parse(os.path.join(target_dir, fname), parser)
        head = tree.find('head')
        head.append(mathjax_elem)

        for image in tree.xpath('//img[@class="math"]'):
          mtext = image.get('alt')
          if mtext:
            elemstring = t.convert(fname, mtext)
            try:
              math_elem = etree.fromstring(elemstring)
            except etree.XMLSyntaxError as e:
              print e
            else:
              image.getparent().replace(image, math_elem)
          else:
            print 'No alt text %s:%s' % (fname, image.get('src'))

        with open(os.path.join(mathml_root, fname), 'wb') as f:
          f.write('<!DOCTYPE html>\n%s' % etree.tostring(tree.getroot(),
                                                          pretty_print=True,
                                                          encoding='UTF-8',
                                                          method='html'))
    </pre></code>
  </section>
  </div>

  <!-- FOOTER  -->
  <div id="footer_wrap" class="outer">
    <footer class="inner">
      <p class="copyright">
        Tralics driver maintained by
        <a href="https://github.com/tiarno">tiarno</a>
      </p>
      <p>
        Published with
        <a href="http://pages.github.com">GitHub Pages</a>
      </p>
    </footer>
  </div>

</body>
</html>